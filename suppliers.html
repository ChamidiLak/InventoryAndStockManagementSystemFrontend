<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transaction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body onload="getSuppliers()">
<div class="container">
    <div class="row">
        <div class="col-md-6 border border-primary mb-1 text-center">
            <h4>View Suppliers</h4>
            <table class="table table-bordered table-striped mt-3" id="suppliersTable">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Address</th>
                </tr>
                </thead>
                <tbody>
                <!-- Supplier rows will be injected here -->
                </tbody>
            </table>
        </div>

        <div class="col-md-6 border border-primary mb-1 text-center">
            <h4>Add Suppliers</h4>
            <form onsubmit="addSuppliers(event)">
                <div class="form-group">
                    <label for="name">Name</label>
                    <input type="text" class="form-control" id="name" required>
                </div>

                <div class="form-group">
                    <label for="address">Address</label>
                    <textarea class="form-control" id="address" rows="3" required></textarea>
                </div>

                <button class="btn btn-primary mt-2" type="submit">Save Changes</button>
            </form>
        </div>
    </div>
</div>

<script src="jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
<script>
    const getSuppliers = async () => {
        const url = "http://localhost:8080/getSuppliers";
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Response status: ${response.status}`);
            }

            const suppliers = await response.json();
            populateSupplierTable(suppliers);
        } catch (error) {
            console.error("Error fetching suppliers:", error.message);
        }
    }

    const populateSupplierTable = (suppliers) => {
        const tableBody = document.querySelector("#suppliersTable tbody");
        tableBody.innerHTML = ""; // Clear previous rows

        suppliers.forEach((supplier) => {
            const row = `
                <tr>
                    <td>${supplier.id}</td>
                    <td>${supplier.name}</td>
                    <td>${supplier.address}</td>
                </tr>
            `;
            tableBody.insertAdjacentHTML("beforeend", row);
        });
    }

    const addSuppliers = async (e) => {
        e.preventDefault();  // Prevent form from refreshing the page

        const name = document.getElementById("name").value.trim();
        const address = document.getElementById("address").value.trim();

        if (!name || !address) {
            alert("Both Name and Address are required.");
            return;
        }

        const body = JSON.stringify({ name, address });

        try {
            const response = await fetch("http://localhost:8080/addSupplier", {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: body,
                cache: 'default'
            });

            if (response.ok) {
                alert("Supplier added successfully.");
                document.getElementById("name").value = "";
                document.getElementById("address").value = "";
                getSuppliers();  // Refresh supplier list
            } else {
                alert("Failed to add supplier.");
            }

        } catch (error) {
            console.error("Error adding supplier:", error.message);
        }
    }
</script>
</body>
</html>
